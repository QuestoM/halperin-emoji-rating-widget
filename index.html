<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Halperin Emoji Rating</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { colors: { brandBlue: '#00B0F0' } } } };
  </script>

  <!-- React 18 + ReactDOM (גרסאות UMD גלובליות) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel-Standalone – קומפילר JSX בזמן-ריצה -->
  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
</head>

<body class="bg-gray-50 flex items-center justify-center min-h-screen">
  <div id="root"></div>

  <!-- הקוד: type=\"text/babel\" כדי שבבל יקמפל ל-JS -->
  <script type="text/babel">
    const { useState }   = React;
    const { createRoot } = ReactDOM;

    /* ---------------- קומפוננטת הדירוג ---------------- */
    const HalperinEmojiRating = () => {
      const [sel, setSel] = useState(null);          // ‎דירוג
      const [view, setV]  = useState('rating');      // rating | feedback | success
      const [good, setG]  = useState('');
      const [bad,  setB]  = useState('');
      const [busy, setBusy]=useState(false);

      const google = 'https://g.page/r/CRKQvqYdnP4sEBM/review';
      const rates  = [
        {v:5,e:'😍',l:'מצוין'},
        {v:4,e:'😊',l:'טוב מאוד'},
        {v:3,e:'😐',l:'בסדר'},
        {v:2,e:'😕',l:'פחות טוב'},
        {v:1,e:'😢',l:'מאכזב'}
      ];

      /* בחירת דירוג */
      const choose = r=>{
        setSel(r);
        if(r.v===5){ setV('success'); setTimeout(()=>location.href=google,4e3);}
        else if(r.v===4){ setV('success'); }
        else { setTimeout(()=>setV('feedback'),250);}
      };

      /* שליחת משוב */
      const send = ()=>{
        if(!bad.trim()&&!good.trim()) return;
        setBusy(true);
        setTimeout(()=>{
          console.log({rating:sel.v,bad,good,t:new Date().toISOString()});
          setBusy(false); setV('success');
        },1e3);
      };

      /* ---------- SUCCESS ---------- */
      if(view==='success'){
        if(sel?.v===5) return (
          <div className="bg-white rounded-xl shadow p-6 max-w-sm text-center border border-gray-100">
            <div className="text-4xl mb-2">🎉</div>
            <h3 className="text-lg font-semibold mb-1">תודה רבה על הדירוג המושלם!</h3>
            <p className="text-sm text-gray-600 mb-4">הקלקה קצרה ב-Google תעזור לנו מאוד 🙏</p>
            <a href={google} className="inline-block px-4 py-2.5 rounded-lg text-white text-sm font-medium"
               style={{background:'#00B0F0'}}>לדירוג ב-Google</a>
            <p className="text-xs text-gray-500 mt-3">נעביר אתכם אוטומטית בעוד 4 שניות…</p>
          </div>);
        if(sel?.v===4) return (
          <div className="bg-white rounded-xl shadow p-6 max-w-sm text-center border border-gray-100">
            <div className="text-4xl mb-2">🙏</div>
            <h3 className="text-lg font-semibold mb-1">תודה על המשוב החיובי!</h3>
            <p className="text-sm text-gray-600">שמחים שנהניתם 🤗</p>
          </div>);
        return (
          <div className="bg-white rounded-xl shadow p-6 max-w-sm text-center border border-gray-100">
            <div className="text-4xl mb-2">✅</div>
            <h3 className="text-lg font-semibold mb-1">קיבלנו, תודה!</h3>
            <p className="text-sm text-gray-600">אנחנו כבר עובדים על שיפור</p>
          </div>);
      }

      /* ---------- FEEDBACK ---------- */
      if(view==='feedback') return (
        <div className="bg-white rounded-xl shadow p-6 max-w-sm border border-gray-100">
          <h3 className="text-base font-semibold mb-4">נשמח לשמוע איך נוכל להשתפר 🙏</h3>
          <div className="space-y-3">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">מה נוכל לשפר? 🎯</label>
              <textarea rows="2" className="w-full text-sm border border-gray-200 rounded-lg px-3 py-2
                                             focus:outline-none focus:ring-2 focus:ring-brandBlue resize-none"
                        placeholder="ספרו לנו מה פחות עבד"
                        value={bad} onChange={e=>setB(e.target.value)} />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">מה אהבתם? 💙</label>
              <textarea rows="2" className="w-full text-sm border border-gray-200 rounded-lg px-3 py-2
                                             focus:outline-none focus:ring-2 focus:ring-brandBlue resize-none"
                        placeholder="רגעים טובים או צוות מצוין"
                        value={good} onChange={e=>setG(e.target.value)} />
            </div>
            <button onClick={send}
                    disabled={busy||(!bad.trim()&&!good.trim())}
                    className="w-full py-2.5 rounded-lg text-white text-sm font-medium disabled:opacity-50
                               flex items-center justify-center gap-1"
                    style={{background:'#00B0F0'}}>
              {busy?'שולח…':<>✉️<span>שלח משוב</span></>}
            </button>
          </div>
        </div>);

      /* ---------- RATING ---------- */
      return (
        <div className="bg-white rounded-xl shadow p-6 max-w-sm border border-gray-100">
          <h2 className="text-base font-semibold text-center mb-5 flex items-center justify-center gap-1">
            איך הייתה החוויה שלכם בסניף? 🤓
          </h2>
          <div className="flex justify-between gap-2">
            {rates.map(r=>(
              <button key={r.v} onClick={()=>choose(r)}
                      className={`flex flex-col items-center gap-1 p-2 rounded-lg transition hover:scale-105
                          ${sel?.v===r.v?'bg-blue-50 border-2 border-brandBlue':'hover:bg-gray-50'}`}
                      style={{minWidth:'54px'}}>
                <span className="text-2xl">{r.e}</span>
                <span className="text-[11px] text-gray-600 leading-tight">{r.l}</span>
              </button>))}
          </div>
        </div>);
    };

    /* הרצה */
    createRoot(document.getElementById('root')).render(<HalperinEmojiRating />);
  </script>
</body>
</html>
